.. index::
   single: convention
   single: best practice

.. _organizing_project_chapter:

Part 3 - Organizing your Project / UI and Simple Templating
===============================================================

At this point we have covered the following

:ref:`planning_mockups_chapter`
    Where we looked at process of planning the user interface (UI) of your application
:ref:`setting_up_dev_chapter`
    This looked at what we needed on our computer to get started.
    We also gained some experience with the framework by creating a simple application.

You should be able to create a simple web application now.

Setting up the Flask Starter Scaffold 
--------------------------------------------

A scaffold refers to a predetermined structure around which you will build your applications.

.. note:: **Why Scaffolds?** Glad you asked! Over the next couple weeks you will be submitting work to be assessed, to simplify things 
    We've developed a standard way of organizing your projects. Maintaining a standard approach means there is one less decision to make when building your applications. 

There are two scaffolds to be used in this course the names are listed below:

**Starter Scaffold**
    This is a simple approach, just enough folders to keep things organized

**GAE Scaffold**
    This arrangement is meant to accomodate projects that will be deployed to Google App Engine, it will seem to be lots of folders, most of them play a supporting role, but all are useful.

Today we will focus on the ``Starter Scaffold``.

.. note:: This section assumes that you have Virtualenv installed. You may find it helpful to 
          review the section entitled :ref:`virtualenv_section`

You will need to download the Flask Starter Scaffold http://dl.dropbox.com/u/1004432/flask_starter.zip
It is best to place it in the same folder where you have your `venv` folder.

Activate your virtual environment (we're assuming that you already installed Flask)::

   source venv/bin/activate

Download and unzip the starter scaffold http://dl.dropbox.com/u/1004432/flask_starter.zip:

The unzipped directory structure looks something like this (for the sake of simplicity, only the key files and folders are listed below)::

	flask_starter
	├── app.py
	├── static
	│   ├── css
	│   ├── images
	│   └── js
	└── templates

Check to see that the scaffold is working by running the following::

The instructions below are for Unix, but
similar steps can be taken on Windows.

#. Copy `flask_starter` to `MyApp`::

       cp -r flask_starter MyApp

#. Activate your Python virtual environment (if you haven't done so already)::

       source venv/bin/activate

#. Test that it is working by launching the default app::

       cd MyApp
       python app.py

Visit your browser at http://localhost:6543, you should see something like the
image below:

.. image:: ../images/scaffoldview.png

If you are on a network with a proxy then pay careful attention to the next section.

Creating the views for our RecipeWebsite application
-------------------------------------------------------

Based on the nature of our application we can predict some of our views
that we will need.

The names below represent reasonable descriptive choices for our Views:

welcome
    a view which shows a welcome or home page, it is associated with the root of the website.

recipe
    when viewing an individual recipe, this view will be used to display all the information for that recipe.

ingredient
    search by ingredient, this view will return a list of recipes that have the particular ingredient.

submitrecipe
    It should be possible to add a new recipe using the 'submit a recipe' link.

registration
    There needs to be a registration page, so that new users can sign up

faq
     This will be a simple view that lists common questions about the web application

Flask does not provide a standard way to manage our code, so we will rely on our `flask starter scaffold`_ to ensure that our applications have a standard and predictable folder structure. 

Our application will have the following sections

You can download our `flask starter app`_ to get going.

.. note:: the term "scaffold" comes from the construction industry and roughly means "structure".


Copy the flask_starter folder to RecipeWebsite::

       cp -r flask_starter RecipeWebsite
    
Enter the `RecipeWebsite` folder


Adding a template in the `templates` folder
--------------------------------------------

In the `templates` folder we will add a new template called `recipe.html`. To make it very 
simple we will just put the phrase, "I am the recipe template".

::

    <h1>I am the recipe template</h1>

We will need a new route before this will work::

	@app.route('/recipe')
	def recipe():
	    return template('recipe.html')


View the new view in your browser
----------------------------------------

Start the application::

    python app.py

Then visit localhost:6543/recipe, you should see something like the image below.

    .. image:: ../images/recipetemplate.jpg

Passing variables to the template
-----------------------------------

Flask uses Jinja2 templates by default.
Variables are generally passed to Jinja2 templates as key value pairs of a python dictionary.
Notice how this approach is used in the app.py file to pass the value of `name` to the index.html template. 
::

	@app.route('/')
	@app.route('/<name>')
	def index(name='Earth'):
	    return template('index.html',name=name)


Defining macros and slots, creating a master template
--------------------------------------------------------

After a while we begin to see things that are common to all templates. Instead of repeating these elements
across different templates, we can share these elements by creating a global or master template.
New templates can be made to inherit from the master template.
In our case the `index.html` template is a good starting point.


Based on our mockups, most pages will be simpler than the front page so we will create a more generic template
based on the `index.html` template. 

.. image:: ../images/recipewebsite-template-innerpage.png

We'll create a new master template called 'global.html' in the `templates` folder. We can use the `index.html` template as the starting point.

The simpler global template can be implemented with 3 rows instead of 5 in the welcome template.

.. image:: ../images/simpletemplate.jpg


XXX Fix me
need to say something about template inheritance

We will pull this off using template inheritance

see: http://flask.pocoo.org/docs/patterns/templateinheritance/

We name our template `global.html`::

	<!DOCTYPE html>
	<html>
	<head>
	<head>
	     <style>
		<!--
		@import url(http://dl.dropbox.com/u/1004432/decogrids-12-gapless.css);
		-->
	      </style>
	</head>
	<body>

	     <div id="row-1" class="row">
		   <div class ="cell position-0 width-3">
		       LOGO will go here
		   </div>


Discussion
-----------

- Any thoughts on what happens when you use virtualenv and the `source bin/activate` command? 

- What do you think happens when you set the `http_proxy` environment variable.?

- What benefits are there in having a standard directory structure?

- Did we need to declare where to look for templates and static files?

- In what way do conventions make source code more maintainable?

.. _the new hotness: http://s3.pixane.com/pip_distribute.png
.. _flask starter scaffold: http://dl.dropbox.com/u/1004432/flask_starter.zip
.. _article about App Engine charges: http://news.ycombinator.com/item?id=3431132
.. _blog post about using flask on GAE: http://www.joemartaganna.com/web-development/how-to-build-a-web-app-using-flask-with-jinja2-in-google-app-engine/
